1. 总体架构

技术栈：

前端：Vue3 / React（SPA）

后端：Vercel Serverless Functions

数据库：MongoDB Atlas（免费 Tier）

架构示意：

浏览器（手机） ↓ 前端 Web（Vercel） ↓ /api/*.js Serverless API ↓ MongoDB Atlas 云数据库

特点：

无常驻进程

按请求弹性扩缩

2. 后端 Serverless 设计
2.1 目录结构（强制）
backend/
├── api/
│   ├── dishes.js
│   ├── orders.js
│   └── admin.js
├── db/
│   └── mongo.js
├── models/
│   ├── Dish.js
│   └── Order.js
├── vercel.json
└── package.json

每个 api/*.js 为一个函数入口

禁止 app.listen

3. MongoDB 连接设计（核心）
3.1 连接复用（必须）
// db/mongo.js
import mongoose from 'mongoose'


const MONGODB_URI = process.env.MONGODB_URI


if (!MONGODB_URI) throw new Error('Missing MONGODB_URI')


let cached = global.mongoose


if (!cached) {
  cached = global.mongoose = { conn: null, promise: null }
}


export async function connectDB() {
  if (cached.conn) return cached.conn


  if (!cached.promise) {
    cached.promise = mongoose.connect(MONGODB_URI)
  }


  cached.conn = await cached.promise
  return cached.conn
}

设计原则：

避免每次请求新建连接

兼容 Vercel 冷启动

4. 数据模型设计（Mongoose）
4.1 Dish 模型
const DishSchema = new mongoose.Schema({
  name: String,
  category: String,
  price: Number,
  imageUrl: String,
  remark: String,
  status: { type: Number, default: 1 }
})
4.2 Order 模型
const OrderSchema = new mongoose.Schema({
  tableNo: String,
  items: [
    {
      dishId: String,
      name: String,
      price: Number,
      quantity: Number
    }
  ],
  totalPrice: Number,
  status: { type: Number, default: 0 },
  createdAt: { type: Date, default: Date.now }
})
5. API 接口设计
5.1 菜单接口
方法	路径	说明
GET	/api/dishes	获取菜单
POST	/api/dishes	新增菜品
PUT	/api/dishes	修改菜品
DELETE	/api/dishes	删除菜品
5.2 订单接口
方法	路径	说明
POST	/api/orders	提交订单
GET	/api/orders?status=0	查询未出餐订单
PUT	/api/orders/finish	标记出餐
5.3 管理接口
方法	路径	说明
POST	/api/admin/login	登录
POST	/api/admin/clear	清空订单
6. 关键架构约束

必须使用 MongoDB Atlas

必须使用连接缓存

禁止本地文件存储

禁止长连接 / WebSocket